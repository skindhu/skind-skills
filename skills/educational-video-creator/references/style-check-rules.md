# 自动样式检查规则

> 本规则集适用于所有教育视频项目。执行检查时，需先从当前项目的
> style-guide.md 和 constants.ts 中提取项目特定的值（如调色板）。

## Table of Contents

- [1. 字号规则](#1-字号规则-1920×1080-画布)
- [2. 调色板](#2-调色板动态提取)
- [3. 安全区域](#3-安全区域-1920×1080-画布)
- [4. 间距规范](#4-间距规范)
- [5. 元素尺寸](#5-元素尺寸)
- [6. 圆角](#6-圆角)
- [7. 禁用模式](#7-禁用模式-remotion-项目通用)
- [8. 布局区域](#8-布局区域-1920×1080-画布)
- [9. 截图审查规则](#9-截图审查规则图像识别)
- [严重级别汇总](#严重级别汇总)

---

## 1. 字号规则 (1920×1080 画布)
| 元素类型 | 最低值 | 推荐值 | 判定方式 |
|----------|--------|--------|----------|
| 主标题 | 48px | 72px | grep fontSize，结合变量名/上下文判断 |
| 段落标题 | 36px | 48px | 同上 |
| 正文/标签 | 36px | 36-48px | 同上 |
| 字幕 | 36px | 40px | Subtitle 组件的 fontSize |
| 小标注 | 24px | 24px | caption 相关上下文 |
| **绝对最低值** | **24px** | — | 任何 fontSize < 24 即为 🔴严重 |

**修复策略**: fontSize < 24 → 改为 24；fontSize 低于元素类型最低值 → 改为该类型推荐值（参照上表）。

来源: style-guide.md Typography 章节

## 2. 调色板（动态提取）

**执行时**从当前项目提取批准颜色:
1. 读取 style-guide.md 中 Color System 章节的所有 hex 值
2. 读取 constants.ts / theme.ts 中定义的颜色常量
3. 汇总为本次检查的 approved palette

通用豁免:
- `rgba()` 半透明色（如 `rgba(0,0,0,0.3)` 用于阴影/遮罩）
- `#000000`, `#ffffff` 黑白基础色
- 渐变过渡色（两端色在调色板内即可）

判定: 提取 TSX 中所有 hex 色值，与 approved palette 比对。不在列表中的标记为 🟡重要。

**修复策略**: 非批准颜色 → 在调色板中找色相距离最近的颜色替换。

## 3. 安全区域 (1920×1080 画布)
- left ≥ 100, right ≤ 1820 (即 left + width ≤ 1820)
- top ≥ 60, bottom ≤ 1020 (即 top + height ≤ 1020)
- 元素超出安全区: 🔴严重
- 字幕区域特例: y 880-1000 为标准字幕位置

**修复策略**: left < 100 → 改为 100；top < 60 → 改为 60；left + width > 1820 → 调整 left 使其 ≤ 1820 - width；top + height > 1020 → 调整 top 使其 ≤ 1020 - height。即夹紧到安全区边界。

## 4. 间距规范
合法值 (8px 倍数体系): 8, 16, 24, 32, 48, 64

判定: 提取 padding / margin / gap 数值
- 不在合法列表但为 8 的倍数 (如 40, 56): 🟢轻微
- 不为 8 的倍数 (如 14, 15, 25): 🟡重要

**修复策略**: 非 8px 倍数 → 四舍五入到最近的 8px 倍数（如 14→16, 25→24）。

## 5. 元素尺寸
- 居中主体宽度: ≥ 画布宽度 15% (≥ 288px)，否则 🟡重要
- 图标/箭头最小尺寸: ≥ 48px
- SVG strokeWidth 标准值: 2, 4, 6，非标准值 🟢轻微

**修复策略**: 图标/箭头 < 48px → 改为 48；居中主体 < 288px → 按比例放大到 288px（同时等比调整高度）。

## 6. 圆角
标准 borderRadius 值: 4, 8, 16 (px) 或 "50%" (圆形)
非标准值: 🟢轻微

**修复策略**: 非标准值 → 四舍五入到最近的标准值（4/8/16）。如值 > 16 且非 "50%"，改为 16。

## 7. 禁用模式 (Remotion 项目通用)
| 禁用模式 | 检测方式 | 严重级别 |
|----------|----------|----------|
| CSS transition | grep `transition:` in style | 🔴严重 |
| Tailwind animate-* | grep `animate-` | 🔴严重 |
| setTimeout 做动画 | grep `setTimeout` + 上下文 | 🔴严重 |
| setInterval 做动画 | grep `setInterval` + 上下文 | 🔴严重 |
| CSS @keyframes | grep `@keyframes` | 🔴严重 |
| requestAnimationFrame | grep `requestAnimationFrame` | 🔴严重 |

正确做法: 所有动画通过 useCurrentFrame() + interpolate() 或 spring()

**修复策略**: 删除 CSS transition / @keyframes / setTimeout / setInterval / requestAnimationFrame / Tailwind animate-* 等禁用模式，改写为等效的 useCurrentFrame() + interpolate()（或 spring()）动画代码。需根据原动画效果逐个改写。

## 8. 布局区域 (1920×1080 画布)
| 区域 | Y 范围 | 用途 |
|------|--------|------|
| 标题区 | 60-200 | 场景标题 |
| 内容区 | 200-700 | 核心内容 |
| 信息卡区 | 650-850 | 补充说明 |
| 字幕区 | 880-1000 | 旁白字幕 |

坐标归一化:
- `top: N` → Y 起点 = N
- `bottom: N` → Y 终点 = 1080 - N，Y 起点 = 1080 - N - 元素估算高度
- 检查时需将所有定位统一转换为 top 值后再比对

重叠检查:
- 文字与文字重叠不可读: 🔴严重
- 非字幕组件（非 SubtitleSequence / Subtitle）的文字元素，其 bottom 边界进入字幕区（Y ≥ 850）: 🔴严重
- **任何 absolute 定位的文字/卡片元素**底部与字幕区顶部（Y=880）间距 < 30px: 🟡重要

**修复策略**: 元素底部侵入字幕区或与字幕间距 < 30px → 上移该元素（减小 top 值或增大 bottom 值）使其底部 ≤ 850（即与字幕区保持 ≥ 30px 间距）。

## 9. 截图审查规则（图像识别）

以下规则通过渲染关键帧截图 + 图像分析执行，用于发现代码扫描无法检测的问题:

### 关键帧选取
- 读取 constants.ts 中 SCENES 对象（或等价的场景定义）
- 每个场景取 4 帧: start（入场）、start + duration/3（1/3 帧）、start + duration*2/3（2/3 帧）、start + duration - 30（尾帧）
- 渲染命令: `npx remotion still --frame <N> --output /tmp/style-check/scene-<name>-f<N>.png <CompositionName>`

### 图像检查项
| 检查项 | 具体检查 | 严重级别 |
|--------|----------|----------|
| 文字可读性 | 文字清晰度、字号视觉效果、背景对比度 | 🔴严重 |
| 元素重叠 | 文字被遮挡、元素不当重叠、信息丢失 | 🔴严重 |
| 安全区域 | 内容被裁切、关键元素贴边 | 🔴严重 |
| 视觉平衡 | 画面重心偏移、留白不合理 | 🟡重要 |
| 颜色和谐 | 配色刺眼、对比度不足 | 🟡重要 |
| 视觉层次 | 主体不突出、信息层级混乱 | 🟡重要 |
| 整体美观 | 画面整洁度、专业感、风格一致性 | 🟢轻微 |

**修复策略**: 截图审查发现的问题需根据具体描述定位源码并修复（无固定策略，靠 AI 根据报告中的修复建议判断）。

## 严重级别汇总
- 🔴严重(必修): fontSize < 24px、超出安全区、禁用动画模式、文字重叠不可读、截图中文字被遮挡
- 🟡重要(应修): 颜色不在调色板、间距非 8px 倍数、居中元素 < 15% 画布宽、画面视觉不平衡
- 🟢轻微(可优化): 间距微偏、圆角不标准、strokeWidth 非标准、整体美观微调
